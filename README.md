# ü§ñ NextPlot LINE Bot

NextPlot ‡∏Ñ‡∏∑‡∏≠ LINE Bot ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Laravel 12 ‡πÅ‡∏•‡∏∞ AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE Messaging API

## ‚ú® ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å

- ü§ñ **AI-Powered Responses** - ‡πÉ‡∏ä‡πâ NLP ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
- üìä **NextPlot Integration** - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö NextPlot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
- ‚òÅÔ∏è **Multi-Cloud Architecture** - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Google Cloud Run (Primary) ‡πÅ‡∏•‡∏∞ Vercel (Backup)
- üíæ **Supabase Storage** - ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ö‡∏ô Supabase
- üîí **Secure & Validated** - ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö LINE Signature ‡πÅ‡∏•‡∏∞ User Allowlist

## üèóÔ∏è ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  LINE User  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     LINE Messaging API Platform     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ Webhook (Primary or Backup)
       ‚îÇ
    ‚îå‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                       ‚îÇ
    ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cloud Run      ‚îÇ   ‚îÇ   Vercel     ‚îÇ
‚îÇ  (Primary)      ‚îÇ   ‚îÇ   (Backup)   ‚îÇ
‚îÇ  Laravel App    ‚îÇ   ‚îÇ   Serverless ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                   ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   Supabase   ‚îÇ
         ‚îÇ   Storage    ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Primary**: Google Cloud Run (2M requests/month Free Tier)  
**Backup**: Vercel (100GB bandwidth/month Free Tier)  
**Storage**: Supabase (Bucket: `nextplot`)

## üöÄ Quick Start

### 1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Dependencies

```powershell
# PHP Dependencies
composer install

# Node.js Dependencies (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
npm install
```

### 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env` ‡∏à‡∏≤‡∏Å `.env.example`:

```powershell
cp .env.example .env
```

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `.env`:

```env
# LINE Messaging API
LINE_CHANNEL_ACCESS_TOKEN="your-channel-access-token"
LINE_CHANNEL_SECRET="your-channel-secret"
LINE_USER_ID_ALLOWLIST="user-id-1,user-id-2"

# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY="your-anon-key"
SUPABASE_SERVICE_ROLE="your-service-role-key"
SUPABASE_BUCKET_NAME=nextplot
```

### 3. ‡∏£‡∏±‡∏ô Development Server

```powershell
# ‡∏ß‡∏¥‡∏ò‡∏µ 1: ‡∏£‡∏±‡∏ô Laravel + Cloudflare Tunnel ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
.\run-all.ps1

# ‡∏ß‡∏¥‡∏ò‡∏µ 2: ‡∏£‡∏±‡∏ô Laravel ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
php artisan serve
```

### 4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö

```powershell
# ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£ (8 tests)
.\test-all.ps1
```

## üìã ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

| ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|----------|
| `.\test-all.ps1` | ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏∏‡∏Å service (8 tests) |
| `.\run-all.ps1` | ‡∏£‡∏±‡∏ô Laravel + Cloudflare Tunnel |
| `.\run-dev.ps1` | ‡∏£‡∏±‡∏ô Laravel development server |
| `.\switch-webhook.ps1` | ‡∏™‡∏•‡∏±‡∏ö LINE webhook ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Cloud Run ‡πÅ‡∏•‡∏∞ Vercel |
| `.\setup.ps1` | ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å |

## üîÑ ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Webhook

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Webhook ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

```powershell
.\switch-webhook.ps1 -Target status
```

### ‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ Cloud Run (Production)

```powershell
.\switch-webhook.ps1 -Target cloudrun
```

### ‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ Vercel (Backup)

```powershell
.\switch-webhook.ps1 -Target vercel
```

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å Service

```powershell
.\test-all.ps1
```

‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö:

- ‚úÖ `.env` configuration
- ‚úÖ Laravel CLI
- ‚úÖ Laravel HTTP server
- ‚úÖ Supabase connection
- ‚úÖ LINE Messaging API
- ‚úÖ Vercel deployment
- ‚úÖ Google Cloud Run
- ‚úÖ Google Cloud Build

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Unit Tests

```powershell
php artisan test
```

## üì¶ Deployment

### Deploy ‡πÑ‡∏õ Google Cloud Run

```powershell
# Deploy ‡∏î‡πâ‡∏ß‡∏¢ Cloud Build
gcloud builds submit --config cloudbuild.yaml

# ‡∏´‡∏£‡∏∑‡∏≠ Deploy ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
gcloud run deploy nextplot-linebot --source .
```

### Deploy ‡πÑ‡∏õ Vercel

```powershell
# Deploy to Production
vercel --prod

# Preview Deployment
vercel
```

## üõ†Ô∏è Development Workflow

### 1. Local Development

```powershell
# ‡πÄ‡∏£‡∏¥‡πà‡∏° Laravel server
php artisan serve

# ‡πÄ‡∏£‡∏¥‡πà‡∏° Cloudflare Tunnel (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö webhook)
.\run-all.ps1
```

### 2. Testing

```powershell
# ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
.\test-all.ps1

# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö webhook ‡∏à‡∏≤‡∏Å LINE
# ‡πÑ‡∏õ‡∏ó‡∏µ‡πà LINE Developers Console > Webhook Settings > Test
```

### 3. Deployment

```powershell
# Push code ‡∏Ç‡∏∂‡πâ‡∏ô GitHub
git add .
git commit -m "Update features"
git push

# Deploy to Cloud Run
gcloud builds submit --config cloudbuild.yaml

# Deploy to Vercel (backup)
vercel --prod
```

## üìù ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

- [DEPLOYMENT.md](DEPLOYMENT.md) - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ deploy ‡πÅ‡∏•‡∏∞ failover
- [QUICK_START.md](QUICK_START.md) - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß
- [SETUP_GUIDE.md](SETUP_GUIDE.md) - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- [LARAVEL_SETUP.md](LARAVEL_SETUP.md) - ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Laravel
- [NEXTPLOT.md](NEXTPLOT.md) - ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ NextPlot API

## üîß Troubleshooting

### Webhook ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

```powershell
# 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö webhook URL ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
.\switch-webhook.ps1 -Target status

# 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Cloud Run
.\test-all.ps1

# 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs
gcloud run logs read nextplot-linebot --limit 50
```

### Supabase Connection Error

```powershell
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT keys ‡πÉ‡∏ô .env ‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ prefix "anon:" ‡∏´‡∏£‡∏∑‡∏≠ "service_role:"
# ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô: SUPABASE_ANON_KEY="eyJhbGci..."
```

### LINE Signature Validation Failed

```env
# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô .env
LINE_SIGNATURE_RELAXED="true"
```

## üåü Free Tier Limits

| Service | Free Tier |
|---------|-----------|
| Google Cloud Run | 2M requests/month |
| Vercel | 100GB bandwidth/month |
| Supabase | 500MB database + 1GB storage |
| Cloudflare Tunnel | Unlimited (for development) |

## üîê Security

- ‡πÑ‡∏ü‡∏•‡πå `.env` ‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô `.gitignore` ‡πÅ‡∏•‡πâ‡∏ß - **‡∏´‡πâ‡∏≤‡∏° commit ‡∏Ç‡∏∂‡πâ‡∏ô Git**
- LINE Signature ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å verify ‡∏ó‡∏∏‡∏Å webhook request
- User Allowlist ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ bot ‡πÑ‡∏î‡πâ

## üìû Support

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:

1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö [DEPLOYMENT.md](DEPLOYMENT.md) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ failover
2. ‡∏£‡∏±‡∏ô `.\test-all.ps1` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cloud Run logs: `gcloud run logs read nextplot-linebot`

## üìÑ License

This project is built on Laravel which is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).

---

Made with ‚ù§Ô∏è using Laravel 12, LINE Messaging API, and Supabase
